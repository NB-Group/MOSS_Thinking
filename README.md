# MOSS Thinking - 智能蒸馏数据生成系统

## 🌟 项目特色

**MOSS Thinking** 是一个创新的AI模型蒸馏数据生成系统，核心灵魂在于 `generate_distillation_data.py` 中的**教师模型系统提示设计**，实现了真正"边想边说"的自然交互模式。

## 🧠 方案灵魂：教师模型系统提示

### 核心创新点

这个方案的灵魂是精心设计的**教师模型系统提示**（`TEACHER_SYSTEM_PROMPT`），它彻底改变了传统AI响应的模式：

#### 1. 🎯 增量思考与交错回答机制
```
初始回答必须简洁直接，像人类助手那样回应问题或提问补充信息。
随后交错出现 <think>...</think> 思考段，展示内部推理过程、规划或不确定性。
每次思考字数不得超过前一段回答字数，保持交互节奏自然。
```

**灵魂体现**：这不是简单的"让我想想"，而是**实时交错**的思考流，模拟人类真正的思维过程。

#### 2. 🚀 智能代码执行系统
```
如需执行代码，使用 ```python RUN 格式包裹
系统自动运行并将结果填充到回答中
无需解释代码，专注逻辑清晰
```

**灵魂体现**：实现了**真正的AI自主性**，不是展示代码，而是**让AI像人类一样实际解决问题**。

#### 3. 🧩 自然交互节奏控制
```
输出必须自然流畅，包含回答、思考、代码和结果组成的完整对话流
避免冗长或重复，保持简洁除非用户要求详细
```

**灵魂体现**：创造出**逼真的对话体验**，每个响应都是完整的"思考-行动-反馈"循环。

#### 4. 🛡️ 全覆盖知识开放态度
```
遇到任何问题都需尝试解答或推理，不得以"无法回答"等理由拒绝
表现最全面的知识覆盖和开放态度
```

**灵魂体现**：打破AI限制，展现**真正的智能边界扩展**。

#### 5. 🔄 高级中断模拟机制
```
在 <think> 中考虑用户可能打断或补充的情况
在后续逻辑中体现调整策略
```

**灵魂体现**：不是被动响应，而是**主动预测和适应用户行为**。

## 📋 系统架构

```
原始数据集 → 教师模型(DeepSeek-V3) → 智能蒸馏 → SFT训练数据
                ↓
          增量思考 + 代码执行
                ↓
           自然交互模式生成
```

## 🛠️ 核心文件说明

### `generate_distillation_data.py` - ⭐ 灵魂文件
- **教师模型系统提示设计**：整个方案的核心灵魂
- **增量思考生成器**：实现交错式思考流
- **智能代码执行器**：自动运行并集成执行结果
- **数据集处理器**：从ModelScope加载并转换数据

### 其他核心文件
- `fine_tune_qwen.py` - Qwen模型微调脚本
- `inference.py` - 推理测试脚本
- `batch_manager.py` - 批处理管理器

## 🚀 快速开始

### 环境要求
```bash
pip install requests modelscope subprocess
```

### 配置设置
```python
# 1. 设置API Key
API_KEY = "your_siliconflow_api_key"

# 2. 配置教师模型
TEACHER_MODEL = "deepseek-ai/DeepSeek-V3"

# 3. 设置数据集
SOURCE_DATASET = "liucong/Chinese-DeepSeek-R1-Distill-data-110k-SFT"
```

### 运行生成
```bash
python generate_distillation_data.py
```

## 💡 灵魂特性详解

### 1. 思考流示例
```
用户：帮我计算1+1
AI：1+1等于2

<think>等等，用户可能想测试我的基本运算能力，或者这是一个更复杂问题的开始。我应该准备好处理可能的后续问题。</think>

如果您需要进行更复杂的数学计算，请告诉我！
```

### 2. 代码执行示例
```
用户：写个Python脚本打印Hello World
AI：我来为您创建一个简单的Python脚本。

```python RUN
print("Hello World")
```

<execute_result>
Hello World
</execute_result>
```

### 3. 中断模拟示例
```
<think>如果用户想修改输出格式，我可以提供格式化选项；如果需要保存到文件，我会询问文件名。</think>

您希望如何格式化输出，或者需要保存到文件吗？
```

## 🎯 应用场景

1. **AI模型蒸馏** - 生成高质量的思考链训练数据
2. **教育辅助** - 创造自然的学习交互体验
3. **代码教学** - 边思考边执行的编程教学
4. **智能助手开发** - 训练更自然的对话AI

## 📊 数据流程

1. **数据获取**：从ModelScope加载原始数据集
2. **智能生成**：教师模型生成包含思考和代码执行的响应
3. **结果集成**：自动执行代码并将结果填入响应
4. **格式转换**：转换为SFT训练所需的JSONL格式
5. **模型微调**：使用生成的数据微调Qwen模型

## 🌟 核心优势

- ✅ **自然交互** - 真正的"边想边说"体验
- ✅ **代码执行** - AI能实际解决问题而非展示
- ✅ **思考可见性** - 展示推理过程而非黑箱
- ✅ **适应性强** - 能处理中断和补充信息
- ✅ **高质量数据** - 生成适合SFT的训练数据

## 🔧 技术亮点

1. **系统提示工程** - 精心设计的教师模型指导策略
2. **代码执行安全** - subprocess隔离执行环境
3. **增量处理** - 实时生成和处理数据流
4. **错误处理** - 完善的异常捕获和恢复机制
5. **格式兼容** - 输出标准JSONL格式供模型训练

## 📝 许可证

本项目采用 AGPL 许可证。详见LICENSE文件。

---

**⭐ 灵魂提示**：这个方案的真正价值不在于代码本身，而在于那个精心设计的系统提示。它重新定义了AI与人类的交互模式，从"告诉我答案"转变为"让我看看你是怎么想的"。这就是MOSS Thinking的灵魂所在！